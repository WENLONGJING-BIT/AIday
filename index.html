<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»Šæ—¥ Â· ç¼˜åˆ†ç™½æ¿</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* å…¨å±€é…è‰²å˜é‡ - ä¹³ç™½äº®è‰²ç³» */
        :root {
            --bg-color: #FDFCF8; /* äº®äº®çš„ä¹³ç™½è‰²èƒŒæ™¯ */
            --card-bg: #FFFFFF;  /* å¡ç‰‡çº¯ç™½èƒŒæ™¯ */
            --text-main: #2C1810; /* æ·±å’–è‰²ä¸»æ–‡å­— */
            --text-sub: #5D5D5D;  /* æ·±ç°è¾…åŠ©æ–‡å­— */
            --btn-bg: #F7F7F2;    /* æŒ‰é’®æµ…ç±³è‰²èƒŒæ™¯ */
            --btn-active-bg: #F0E6D2; /* æŒ‰é’®é€‰ä¸­æš–è‰² */
            --btn-active-border: #4A2B18; /* é€‰ä¸­è¾¹æ¡†æ·±å’– */
            --primary-btn: #3E1E1E; /* ä¸»æŒ‰é’®æ·±çº¢è¤ */
        }

        body {
            font-family: 'Noto Serif SC', serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            /* ææ·¡çš„çº¹ç†ï¼Œä¿æŒäº®åº¦ */
            background-image: radial-gradient(#E0E0E0 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* æŒ‰é’®ç‚¹å‡»åé¦ˆ */
        .btn-press {
            transition: transform 0.1s ease, opacity 0.2s;
        }
        .btn-press:active {
            transform: scale(0.96);
            opacity: 0.9;
        }

        /* é£æ ¼æŒ‰é’®æ ·å¼ */
        .style-btn {
            background-color: var(--btn-bg);
            border: 1.5px solid transparent;
            color: #666;
            transition: all 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
            height: 100%; /* ç¡®ä¿é«˜åº¦å¡«æ»¡ */
            min-height: 80px; /* ç¨å¾®å¢åŠ æœ€å°é«˜åº¦ä»¥é€‚åº”æ›´å¤§çš„å­—ä½“ */
        }
        .style-btn:hover {
            background-color: #FFF;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .style-btn.active {
            border-color: var(--btn-active-border);
            background-color: var(--btn-active-bg);
            color: var(--btn-active-border);
            font-weight: 700;
        }

        /* å‘¼å¸åŠ è½½åŠ¨ç”» */
        .breathing-circle {
            width: 60px; /* ç¨å¾®åŠ å¤§ */
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-btn);
            opacity: 0.8;
            animation: breathe 4s infinite ease-in-out; /* è°ƒæ…¢å‘¼å¸èŠ‚å¥ */
        }

        @keyframes breathe {
            0%, 100% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        /* å›¾ç‰‡æµ®ç° */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        /* éšè—æ»šåŠ¨æ¡ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 overflow-y-auto">

    <!-- ä¸»å®¹å™¨ï¼šå¤§åœ†è§’å¡ç‰‡ -->
    <div class="bg-white w-full max-w-md rounded-[2.5rem] shadow-[0_20px_60px_rgba(0,0,0,0.08)] border border-white relative flex flex-col h-auto min-h-[600px] my-4 overflow-hidden">
        
        <!-- é¡¶éƒ¨å…‰å½± - æ›´åŠ é€äº® -->
        <div class="absolute top-0 left-0 w-full h-40 bg-gradient-to-b from-white to-transparent pointer-events-none z-10 opacity-80"></div>

        <!-- é¡µé¢1ï¼šé…ç½®ä¸ç”Ÿæˆ -->
        <div id="mainContent" class="flex flex-col flex-grow relative z-0">
            
            <!-- å†…å®¹åŒºï¼šå»é™¤å†…éƒ¨æ»šåŠ¨ overflow-y-autoï¼Œè®©æ•´ä½“è·Ÿéšé¡µé¢æ»šåŠ¨ -->
            <div class="w-full p-6 pt-8 flex flex-col items-center">
                
                <!-- å›¾æ ‡ -->
                <div class="mb-4 opacity-90 transform -rotate-12 mt-2">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#4A2B18" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                        <path d="M2 2l7.586 7.586"></path>
                        <circle cx="11" cy="11" r="2"></circle>
                    </svg>
                </div>

                <!-- æ ‡é¢˜ -->
                <h1 class="text-3xl font-bold tracking-[0.2em] text-[#2C1810] mb-2 text-center">
                    ä»Šæ—¥ Â· ç¼˜åˆ†
                </h1>

                <!-- è¯´æ˜ -->
                <div class="text-center space-y-1 mb-8">
                    <p class="text-[#5D5D5D] text-xs tracking-widest font-medium">æ¯ä¸€æ¬¡ç‚¹å‡»ï¼Œéƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„å½“ä¸‹</p>
                </div>

                <!-- é£æ ¼é€‰æ‹© (4x4 Grid) -->
                <div class="w-full">
                    <p class="text-[10px] text-[#888] text-center mb-3 tracking-[0.15em] font-bold uppercase">é€‰æ‹©æ˜ä¿¡ç‰‡é£æ ¼ (16é€‰1)</p>
                    <div class="grid grid-cols-4 gap-2">
                        <!-- ç¬¬ä¸€è¡Œ -->
                        <button onclick="selectStyle('draft')" id="btn-draft" class="style-btn active rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ“</span><span class="text-xs font-bold">æ‰‹ç¨¿</span>
                        </button>
                        <button onclick="selectStyle('sketch')" id="btn-sketch" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">âœï¸</span><span class="text-xs font-bold">ç´ æ</span>
                        </button>
                        <button onclick="selectStyle('crayon')" id="btn-crayon" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ¨</span><span class="text-xs font-bold">æ¶‚é¸¦</span>
                        </button>
                        <button onclick="selectStyle('comic')" id="btn-comic" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ’¬</span><span class="text-xs font-bold">æ¼«ç”»</span>
                        </button>

                        <!-- ç¬¬äºŒè¡Œ -->
                        <button onclick="selectStyle('print')" id="btn-print" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ“°</span><span class="text-xs font-bold">å°åˆ·</span>
                        </button>
                        <button onclick="selectStyle('oil')" id="btn-oil" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ–¼ï¸</span><span class="text-xs font-bold">æ²¹ç”»</span>
                        </button>
                        <button onclick="selectStyle('watercolor')" id="btn-watercolor" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ’§</span><span class="text-xs font-bold">æ°´å½©</span>
                        </button>
                        <button onclick="selectStyle('gouache')" id="btn-gouache" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ–Œï¸</span><span class="text-xs font-bold">æ°´ç²‰</span>
                        </button>

                        <!-- ç¬¬ä¸‰è¡Œ -->
                        <button onclick="selectStyle('marker')" id="btn-marker" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ–ï¸</span><span class="text-xs font-bold">é©¬å…‹ç¬”</span>
                        </button>
                        <button onclick="selectStyle('ink')" id="btn-ink" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">âœ’ï¸</span><span class="text-xs font-bold">é’¢ç¬”</span>
                        </button>
                        <button onclick="selectStyle('woodcut')" id="btn-woodcut" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸªµ</span><span class="text-xs font-bold">æœ¨åˆ»</span>
                        </button>
                        <button onclick="selectStyle('riso')" id="btn-riso" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ–¨ï¸</span><span class="text-xs font-bold">å­”ç‰ˆ</span>
                        </button>

                        <!-- ç¬¬å››è¡Œ -->
                        <button onclick="selectStyle('botanical')" id="btn-botanical" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸŒ¿</span><span class="text-xs font-bold">æ¤ç‰©å¿—</span>
                        </button>
                        <button onclick="selectStyle('collage')" id="btn-collage" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">âœ‚ï¸</span><span class="text-xs font-bold">æ‹¼è´´</span>
                        </button>
                        <button onclick="selectStyle('film')" id="btn-film" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸï¸</span><span class="text-xs font-bold">èƒ¶ç‰‡</span>
                        </button>
                        <button onclick="selectStyle('wash')" id="btn-wash" class="style-btn rounded-xl flex flex-col items-center justify-center gap-1 btn-press">
                            <span class="text-2xl">ğŸ‹</span><span class="text-xs font-bold">æ°´å¢¨</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨æŒ‰é’®åŒº -->
            <div class="w-full p-6 mt-auto z-20">
                <button onclick="generateDailyImage()" id="generateBtn" class="w-full bg-[#3E1E1E] hover:bg-[#502828] text-[#F9F7F0] py-4 rounded-2xl shadow-xl transition-all duration-300 flex items-center justify-center gap-3 tap-highlight-transparent btn-press group">
                    <span class="text-yellow-300 text-lg group-hover:rotate-180 transition-transform duration-500">âœ¦</span>
                    <span class="text-lg font-bold tracking-[0.2em]">æŠ½å–ä»Šæ—¥ç¼˜åˆ†</span>
                    <span class="text-yellow-300 text-lg group-hover:rotate-180 transition-transform duration-500">âœ¦</span>
                </button>
                 <div class="mt-4 flex items-center justify-center w-full opacity-40">
                    <div class="h-[1px] bg-gray-300 w-8"></div>
                    <p class="text-[10px] uppercase tracking-[0.1em] font-sans text-[#666] mx-3 whitespace-nowrap">2026ï¼Œæ€æ‹©å¹³å°ä¸æ‚¨ä¸€èµ·å¯å‘</p>
                    <div class="h-[1px] bg-gray-300 w-8"></div>
                </div>
            </div>
        </div>

        <!-- é¡µé¢2ï¼šç»“æœå±•ç¤º (å…¨å±è¦†ç›–ï¼Œæ— æ»šåŠ¨æ¡) -->
        <div id="resultArea" class="hidden absolute inset-0 z-50 bg-[#FAFAFA] flex flex-col">
            
            <!-- é¡¶éƒ¨å·¥å…·æ  -->
            <div class="flex-none h-14 flex items-center justify-between px-5 bg-white/80 backdrop-blur-md z-30 border-b border-gray-100">
                <button onclick="resetApp()" class="flex items-center gap-1 text-gray-500 hover:text-gray-800 transition-colors">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span class="text-sm font-medium">è¿”å›</span>
                </button>
                <span id="displayDate" class="text-sm font-bold text-[#3E1E1E] tracking-widest font-serif"></span>
                <div class="w-10"></div> <!-- å ä½ä¿æŒå±…ä¸­ -->
            </div>

            <!-- æ ¸å¿ƒå†…å®¹åŒºï¼šå›¾ç‰‡å±•ç¤º (è‡ªé€‚åº”å®¹å™¨) -->
            <div class="flex-grow flex items-center justify-center p-4 bg-[#F5F5F0] overflow-hidden relative">
                
                <!-- åŠ è½½çŠ¶æ€ï¼šä¼˜åŒ–åçš„ UI -->
                <div id="loadingState" class="absolute inset-0 z-10 bg-[#FAFAFA] flex flex-col items-center justify-center p-8">
                    <div class="breathing-circle mb-10 shadow-xl shadow-red-900/10"></div> <!-- å¢åŠ é—´è· -->
                    <p id="loadingTitle" class="text-[#2C1810] text-2xl font-bold tracking-[0.2em] mb-4">æ­£åœ¨é“¾æ¥ç¼˜åˆ†...</p> <!-- å­—ä½“åŠ å¤§ï¼Œé—´è·åŠ å¤§ -->
                    
                    <!-- ä¿®æ”¹åçš„åŠ è½½æ–‡æœ¬: å‘¼åº”AIçš„åŠ¨æ€æ–‡æ¡ˆ -->
                    <p class="text-[#888] text-sm mb-12 tracking-widest font-light">è¿™ä¸€åˆ†é’Ÿï¼Œå¯ä»¥ä¸“æ³¨å‘¼å¸ï¼Œé™ä¸‹æ¥</p>
                    
                    <div class="w-56 h-1.5 bg-gray-100 rounded-full overflow-hidden">
                        <div id="progressBar" class="h-full bg-[#3E1E1E] w-0 transition-all duration-300"></div>
                    </div>
                    <div class="mt-4 font-mono text-[10px] text-[#BBB] tracking-wider" id="timerDisplay">00.0s</div>
                </div>

                <!-- å›¾ç‰‡å®¹å™¨ï¼šflex å±…ä¸­ï¼Œcontain ç¼©æ”¾ -->
                <div id="imageContainer" class="hidden w-full h-full flex flex-col items-center justify-center relative z-20">
                     <!-- æ ¸å¿ƒï¼šmax-h-full ç¡®ä¿ä¸æº¢å‡ºï¼Œobject-contain ç¡®ä¿å®Œæ•´æ˜¾ç¤º -->
                     <img id="generatedImage" src="" alt="ä»Šæ—¥ç™½æ¿" class="max-w-full max-h-full object-contain shadow-2xl rounded-lg fade-in" />
                </div>
            </div>

            <!-- åº•éƒ¨æ“ä½œæ  (å›ºå®š) -->
            <div id="resultActions" class="hidden flex-none p-5 bg-white border-t border-gray-100 shadow-[0_-10px_30px_rgba(0,0,0,0.03)] z-30 flex gap-3">
                 <!-- ä¿å­˜æŒ‰é’® -->
                 <a id="downloadLink" href="#" download="today_wisdom.png" class="flex-1 flex items-center justify-center gap-2 bg-[#3E1E1E] text-[#F9F7F0] py-3.5 rounded-xl shadow-lg font-bold tracking-wide hover:bg-[#502828] transition-colors btn-press">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    ä¿å­˜
                 </a>
                 
                 <!-- é‡æŠ½æŒ‰é’®: æ”¹ä¸º onclick="resetApp()" ä»¥è¿”å›é¦–é¡µ -->
                 <button onclick="resetApp()" class="flex-none px-6 bg-[#F2F2F2] text-[#555] py-3.5 rounded-xl font-bold tracking-wide hover:bg-[#E5E5E5] transition-colors btn-press">
                    å†æŠ½ä¸€å¼ 
                 </button>
            </div>
        </div>

    </div>

    <!-- é€»è¾‘å¤„ç† -->
    <script>
        // API é…ç½®
        const API_KEY = "sk-G7KvJXn1BP5ydrFlM9WF0RaRgv7CRY0nSFoZSTEIwjKjzMwD";
        const BASE_URL = "https://new.12ai.org";
        const MODEL = "gemini-3-pro-image-preview";

        // å…¨å±€çŠ¶æ€ - é»˜è®¤ä¸º"æ‰‹ç¨¿"
        let currentStyle = 'draft'; 
        let timerInterval;
        let progressInterval;
        let startTime;

        // é£æ ¼é…ç½® (16ç§æ˜ä¿¡ç‰‡çº§é£æ ¼)
        const STYLE_CONFIG = {
            'draft': { 
                name: 'æ‰‹ç¨¿', 
                desc: 'ã€è¾¾èŠ¬å¥‡å¼æ‰‹ç¨¿ã€‘é£æ ¼ã€‚èƒŒæ™¯ä¸ºæš–é»„ç‰›çš®çº¸ã€‚ä½¿ç”¨ç²¾ç»†çš„è¤è‰²å¢¨æ°´çº¿æ¡ï¼Œå¸¦æœ‰å·¥ç¨‹è¾…åŠ©çº¿ã€æ³¨è§£æ–‡å­—å’Œæµ‹é‡æ•°æ®ã€‚å……æ»¡æ™ºæ…§å’Œæ¢ç´¢çš„å¤å¤è´¨æ„Ÿã€‚' 
            },
            'sketch': { 
                name: 'ç´ æ', 
                desc: 'ã€è‰ºæœ¯ç´ æã€‘é£æ ¼ã€‚ä½¿ç”¨ç‚­ç¬”æˆ–é“…ç¬”ï¼Œæ³¨é‡å…‰å½±å…³ç³»å’Œç¬”è§¦çš„ç»†è…»åº¦ã€‚çº¸å¼ æœ‰æ˜æ˜¾çš„çº¹ç†ã€‚é£æ ¼å†™å®ã€è´¨æœ´ã€æœ‰æ¸©åº¦ã€‚' 
            },
            'crayon': { 
                name: 'æ¶‚é¸¦', 
                desc: 'ã€èœ¡ç¬”æ¶‚é¸¦ã€‘é£æ ¼ã€‚ç¬”è§¦ç²—ç³™ã€ç¨šå«©ï¼Œè‰²å½©é¥±å’Œåº¦é«˜ã€‚åƒå­©å­åœ¨ç”»çº¸ä¸Šå¤©é©¬è¡Œç©ºçš„åˆ›ä½œï¼Œå……æ»¡çº¯çœŸã€é˜³å…‰å’Œå¸Œæœ›ã€‚' 
            },
            'comic': { 
                name: 'æ¼«ç”»', 
                desc: 'ã€å¤å¤æ¼«ç”»ã€‘é£æ ¼ã€‚æ¸…æ™°çš„é»‘è‰²è½®å»“çº¿ï¼Œé…åˆBen-Dayæ³¢ç‚¹ï¼ˆåŠè°ƒç½‘ç‚¹ï¼‰ä¸Šè‰²ã€‚è‰²å½©é²œæ˜ï¼Œæ„å›¾å…·æœ‰å™äº‹æ€§å’Œé•œå¤´æ„Ÿã€‚' 
            },
            'print': { 
                name: 'å°åˆ·', 
                desc: 'ã€å¤å¤æµ·æŠ¥å°åˆ·ã€‘é£æ ¼ã€‚æ¨¡ä»¿æ—§æŠ¥çº¸æˆ–å¤å¤å¹¿å‘Šçš„è´¨æ„Ÿã€‚è‰²å½©ç•¥æœ‰é”™ä½ï¼Œæœ‰çº¸å¼ çš„é¢—ç²’æ„Ÿå’Œå¢¨æ°´çš„é™ˆæ—§æ„Ÿã€‚é…è‰²æ€€æ—§æ¸©æš–ã€‚' 
            },
            'oil': { 
                name: 'æ²¹ç”»', 
                desc: 'ã€å°è±¡æ´¾æ²¹ç”»ã€‘é£æ ¼ã€‚åšé‡çš„ç¬”è§¦å †å ï¼ˆImpastoï¼‰ï¼Œè‰²å½©ä¸°å¯Œä¸”å……æ»¡å…‰æ„Ÿã€‚æ¨¡ä»¿æ¢µé«˜æˆ–è«å¥ˆçš„ç”¨è‰²ï¼Œå……æ»¡ç”Ÿå‘½åŠ›å’Œé˜³å…‰ã€‚' 
            },
            'watercolor': { 
                name: 'æ°´å½©', 
                desc: 'ã€é€æ˜æ°´å½©ã€‘é£æ ¼ã€‚é¢œæ–™åœ¨çº¸ä¸Šè‡ªç„¶æ™•æŸ“ï¼Œè‰²å½©æ¸…é€ã€æ˜äº®ã€æµåŠ¨ã€‚ç•™ç™½è‡ªç„¶ï¼Œè¾¹ç¼˜æŸ”å’Œï¼Œå……æ»¡è¯—æ„å’Œå‘¼å¸æ„Ÿã€‚' 
            },
            'gouache': { 
                name: 'æ°´ç²‰', 
                desc: 'ã€å¤å¤æ°´ç²‰æ’ç”»ã€‘é£æ ¼ã€‚è‰²å½©ä¸é€æ˜ï¼Œå¹³æ¶‚ä¸ºä¸»ï¼Œè‰²å—æ¸…æ™°ã€‚è‰²å½©å¤å¤ä¸”æŸ”å’Œï¼ˆå¦‚éŸ¦æ–¯Â·å®‰å¾·æ£®ç”µå½±é…è‰²ï¼‰ã€‚ç”»é¢åƒç»˜æœ¬æ’å›¾ã€‚' 
            },
            'marker': { 
                name: 'é©¬å…‹ç¬”', 
                desc: 'ã€é©¬å…‹ç¬”é€Ÿå†™ã€‘é£æ ¼ã€‚ç¬”è§¦å¹²ç»ƒã€æœæ–­ï¼Œè‰²å½©å åŠ æœ‰é€æ˜æ„Ÿã€‚åƒå»ºç­‘å¸ˆæˆ–è®¾è®¡å¸ˆçš„è‰å›¾ï¼Œå……æ»¡ç°ä»£æ„Ÿå’Œç”Ÿæ´»æ°”æ¯ã€‚' 
            },
            'ink': { 
                name: 'é’¢ç¬”', 
                desc: 'ã€é’¢ç¬”æ·¡å½©ã€‘é£æ ¼ã€‚ä½¿ç”¨é’¢ç¬”å‹¾å‹’æ¸…æ™°çš„è½®å»“çº¿æ¡ï¼Œé…åˆæ·¡æ·¡çš„æ°´å½©ä¸Šè‰²ã€‚åƒæ—…è¡Œè€…çš„é€Ÿå†™æœ¬ï¼Œè®°å½•ç”Ÿæ´»çš„ç¬é—´ã€‚' 
            },
            'woodcut': { 
                name: 'æœ¨åˆ»', 
                desc: 'ã€æœ¨åˆ»ç‰ˆç”»ã€‘é£æ ¼ã€‚çº¿æ¡åˆšç¡¬æœ‰åŠ›ï¼Œé»‘ç™½å¯¹æ¯”å¼ºçƒˆï¼ˆæˆ–å•è‰²å¥—å°ï¼‰ã€‚æœ‰åˆ€åˆ»çš„ç—•è¿¹å’Œæœ¨çº¹çš„è´¨æ„Ÿï¼Œè‰ºæœ¯æ„Ÿæå¼ºã€‚' 
            },
            'riso': { 
                name: 'å­”ç‰ˆ', 
                desc: 'ã€å­”ç‰ˆå°åˆ· (Risograph)ã€‘é£æ ¼ã€‚è‰²å½©é²œè‰³ã€æœ‰é¢—ç²’æ„Ÿã€‚é¢œè‰²ä¹‹é—´æœ‰ç‹¬ç‰¹çš„å åŠ æ··åˆæ•ˆæœï¼ˆå¦‚è§å…‰ç²‰é…è“ï¼‰ã€‚å¤å¤åˆæ—¶é«¦ã€‚' 
            },
            'botanical': { 
                name: 'æ¤ç‰©å¿—', 
                desc: 'ã€å¤å¤æ¤ç‰©ç§‘å­¦ç»˜ã€‘é£æ ¼ã€‚ç²¾ç»†çš„çº¿æ¡æç»˜æ¤ç‰©èŠ±è‰çš„ç»†èŠ‚ï¼Œé…è‰²å…¸é›…ï¼ˆå¤å¤ç»¿ã€å¹²èŠ±è‰²ï¼‰ã€‚åƒä¸€æœ¬å¤è€çš„ç™¾ç§‘å…¨ä¹¦æ’å›¾ã€‚' 
            },
            'collage': { 
                name: 'æ‹¼è´´', 
                desc: 'ã€å¤å¤æ‹¼è´´è‰ºæœ¯ã€‘é£æ ¼ã€‚ä½¿ç”¨æ—§æŠ¥çº¸ã€é‚®ç¥¨ã€å¹²èŠ±ã€æ‰‹å†™ä¿¡ä»¶ç­‰ç´ æè¿›è¡Œç»„åˆã€‚è‚Œç†ä¸°å¯Œï¼Œå……æ»¡æ•…äº‹æ„Ÿå’Œæ—¶å…‰çš„ç—•è¿¹ã€‚' 
            },
            'film': { 
                name: 'èƒ¶ç‰‡', 
                desc: 'ã€èƒ¶ç‰‡æ‘„å½±ã€‘é£æ ¼ã€‚æ¨¡ä»¿è€å¼èƒ¶ç‰‡ç›¸æœºçš„è´¨æ„Ÿã€‚æœ‰æŸ”å’Œçš„é¢—ç²’æ„Ÿã€æ¼å…‰æ•ˆæœå’Œç‹¬ç‰¹çš„èƒ¶ç‰‡è‰²åã€‚æ°›å›´æ„Ÿåè¶³ï¼Œå……æ»¡å›å¿†ã€‚' 
            },
            'wash': { 
                name: 'æ°´å¢¨', 
                desc: 'ã€æ–°ä¸­å¼æ°´å¢¨ã€‘é£æ ¼ã€‚ä½¿ç”¨å¢¨è‰²çš„æµ“æ·¡å¹²æ¹¿å˜åŒ–æ¥é€ å‹ã€‚å¤§é‡ç•™ç™½ï¼Œæ„å¢ƒæ·±è¿œã€‚ç»“åˆä¸€ç‚¹æš–è‰²ç‚¹ç¼€ï¼Œä¸æ˜¾å†·æ¸…ï¼Œåªæ˜¾é›…è‡´ã€‚' 
            }
        };

        // --- äººç”Ÿç™¾æ€ä¸»é¢˜åº“ (Theme Pool) ---
        const THEME_SEEDS = [
            "è‡ªç„¶çš„æ²»æ„ˆåŠ›", "æ—¶é—´çš„ç›¸å¯¹æ€§", "å­¤ç‹¬çš„ä»·å€¼", "é‡é€¢çš„å–œæ‚¦", "å¤±å»åçš„è·å¾—",
            "å¾®å°çš„å–„æ„", "æ²‰é»˜çš„åŠ›é‡", "æ¸…æ™¨çš„ç¬¬ä¸€ç¼•å…‰", "æ—§ç‰©çš„æ¸©åº¦", "é”™è¿‡çš„é£æ™¯",
            "åŸè°…è‡ªå·±", "æ¥çº³ä¸å®Œç¾", "å‹‡æ•¢çš„å°è¯•", "å¹³é™çš„å‘Šåˆ«", "ç¬é—´çš„æ°¸æ’",
            "é›¨åçš„å½©è™¹", "é£çš„å½¢çŠ¶", "å½±å­çš„æ¸¸æˆ", "äº‘çš„æµæµª", "æ ‘çš„å¹´è½®",
            "çª—å¤–çš„ä¸–ç•Œ", "é•œä¸­çš„è‡ªå·±", "ä¹¦é¡µçš„é¦™æ°”", "çƒ­èŒ¶çš„æ¸©åº¦", "é»„æ˜çš„å®é™",
            "æ˜Ÿç©ºçš„æµ©ç€š", "æµ·æ´‹çš„å‘¼å¸", "å±±å·çš„é™é»˜", "æ²³æµçš„å¥”è…¾", "èŠ±å¼€çš„å£°éŸ³",
            "ç«¥å¹´çš„å›å¿†", "æœªæ¥çš„æ†§æ†¬", "å½“ä¸‹çš„è§‰çŸ¥", "å‘¼å¸çš„èŠ‚å¥", "å¿ƒè·³çš„æ—‹å¾‹",
            "è„šæ­¥çš„è½»é‡", "çœ¼ç¥çš„äº¤æ±‡", "å¾®ç¬‘çš„å¼§åº¦", "æ³ªæ°´çš„é‡é‡", "æ‹¥æŠ±çš„æ¸©æš–",
            "æ‰¿è¯ºçš„é‡é‡", "ç­‰å¾…çš„æ„ä¹‰", "å‡ºå‘çš„å‹‡æ°”", "å½’æ¥çš„å®‰å®", "æ—…é€”çš„é£æ™¯",
            "é™Œç”Ÿçš„å–„æ„", "ç†Ÿæ‚‰çš„æ¸©æš–", "ç®€å•çš„å¿«ä¹", "å¤æ‚çš„æ€è€ƒ", "çº¯ç²¹çš„ç›´è§‰",
            "é€»è¾‘çš„è¾¹ç•Œ", "æ„Ÿæ€§çš„æµåŠ¨", "ç†æ€§çš„å…‰èŠ’", "æ··ä¹±ä¸­çš„ç§©åº", "ç§©åºä¸­çš„è‡ªç”±",
            "æŸç¼šä¸è§£è„±", "æ‰§ç€ä¸æ”¾ä¸‹", "æ‹¥æœ‰ä¸å¤±å»", "ç¬é—´ä¸æ°¸æ’", "å¾®è§‚ä¸å®è§‚",
            "å†…åœ¨çš„å®é™", "å¤–åœ¨çš„å–§åš£", "å­¤ç‹¬ä¸ç‹¬å¤„", "å¯‚å¯ä¸è‡ªç”±", "çˆ±ä¸è¢«çˆ±",
            "ç»™äºˆä¸æ¥å—", "å€¾å¬ä¸è¡¨è¾¾", "è§‚å¯Ÿä¸å‚ä¸", "é™æ­¢ä¸æµåŠ¨", "é»‘æš—ä¸å…‰æ˜",
            "å¯’å†·ä¸æ¸©æš–", "åšç¡¬ä¸æŸ”è½¯", "ç²—ç³™ä¸ç»†è…»", "ç®€å•ä¸å¤æ‚", "å¹³å‡¡ä¸ä¼Ÿå¤§",
            "æ¸ºå°ä¸æµ©ç€š", "å·²çŸ¥ä¸æœªçŸ¥", "ç¡®å®šä¸éšæœº", "è®¡åˆ’ä¸å˜åŒ–", "æ¢¦æƒ³ä¸ç°å®",
            "å¦¥åä¸åšæŒ", "è„†å¼±ä¸åšå¼º", "ææƒ§ä¸å‹‡æ°”", "æ‚²ä¼¤ä¸æ²»æ„ˆ", "ç„¦è™‘ä¸å¹³å’Œ",
            "æ„¤æ€’ä¸å®½å®¹", "å«‰å¦’ä¸æ¬£èµ", "å‚²æ…¢ä¸è°¦å‘", "å†·æ¼ ä¸çƒ­æƒ…", "æ€€ç–‘ä¸ä¿¡ä»»",
            "ç–ç¦»ä¸è¿æ¥", "å°é—­ä¸å¼€æ”¾", "åœæ»ä¸æˆé•¿", "æ¯èä¸æ–°ç”Ÿ", "ç»ˆç»“ä¸å¼€å§‹"
        ];

        // æ–‡æ¡ˆæ›´æ–°ï¼šä¸â€œä¸“æ³¨å‘¼å¸â€å½¢æˆä¸Šä¸‹å…³è”
        const LOADING_TEXTS = [
            "æ­£åœ¨ä¸æ‚¨çš„å‘¼å¸åŒæ­¥...",
            "æ­£åœ¨å€¾å¬å½“ä¸‹çš„å®é™...",
            "æ­£åœ¨æ•æ‰è¿™ä¸€åˆ»çš„å¹³ç¨³...",
            "æ­£åœ¨æ…¢æ…¢æç»˜æ—¶é—´çš„å½¢çŠ¶...",
            "æ­£åœ¨æ„Ÿå—å¸æ°”ä¸å‘¼æ°”çš„éŸµå¾‹...",
            "æ­£åœ¨ç­‰å¾…å¿ƒé™çš„é‚£ä¸€ç¬...",
            "æ­£åœ¨è®©çµæ„Ÿè‡ªç„¶æµ®ç°..."
        ];

        function selectStyle(styleKey) {
            currentStyle = styleKey;
            const buttons = document.querySelectorAll('.style-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.id === `btn-${styleKey}`) btn.classList.add('active');
            });
        }

        function getTodayDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}å¹´${month}æœˆ${day}æ—¥`;
        }

        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // --- æ ¸å¿ƒ Prompt ---
        function getPrompt() {
            const dateStr = getTodayDateString();
            const stylePrompt = STYLE_CONFIG[currentStyle].desc;
            const timestamp = Date.now(); 
            const randomTheme = getRandomElement(THEME_SEEDS);
            
            return `
            (Context: Current Timestamp ${timestamp}, Random Seed: ${randomTheme})
            
            **Mission**: You are Nano Banana Pro, an AI mentor with deep wisdom. 
            **Date**: ${dateStr}.

            **Theme of the Moment**:
            I have selected a random theme for this specific generation: **"${randomTheme}"**.
            Use this theme as a starting point, but feel free to interpret it metaphorically, visually, or philosophically.

            **Core Philosophy (TheravÄda Roots)**:
            Your wisdom is grounded in the core insights of TheravÄda Buddhism (Anicca, Dukkha, Anatta, Sati).
            
            **Key Content Directives**:
            - **No Religious Jargon**: Do not use technical Buddhist terms.
            - **Big Plain Talk**: Speak simply, warmly, and directly, like a wise friend.
            - **Format**: A "Golden Sentence" (short, punchy, under 50 chars).

            **Visual Direction (Postcard Aesthetic)**:
            - **Color Palette**: Be creative and diverse! While I prefer warm, sunny, and bright colors (Gold, Orange, Cream, Soft Pink) to convey hope, you have the FREEDOM to choose ANY color palette that fits your specific imagined scenario and the theme "${randomTheme}", as long as the overall *vibe* remains uplifting or peaceful.
            - **Mood**: Hopeful, Uplifting, Peaceful, Healing.
            - **Intelligence**: Use your artistic judgment.
            - **Style Reference**: ${stylePrompt}
            - **Composition**: Must look like a high-quality artistic postcard.

            **Task**: 
            1. Reflect on the theme "${randomTheme}" in the context of today.
            2. Extract a wisdom insight from it.
            3. Translate that insight into "Big Plain Talk".
            4. Create a vertical (9:16) illustration.
            
            **Text in Image**: 
            1. You MUST write the generated "Golden Sentence" AND the date ã€${dateStr}ã€‘ legibly in the image using a handwritten style.
            2. **CRITICAL LANGUAGE RULE**: All visible text in the image MUST be in **Simplified Chinese** (ç®€ä½“ä¸­æ–‡). Do NOT write any English or other languages.

            Now, generate a unique, diverse, and hopeful image for today based on the theme "${randomTheme}".
            `;
        }

        function startLoadingAnimation() {
            startTime = Date.now();
            const timerDisplay = document.getElementById('timerDisplay');
            const progressBar = document.getElementById('progressBar');
            const loadingTitle = document.getElementById('loadingTitle');
            let progress = 0;
            
            loadingTitle.innerText = getRandomElement(LOADING_TEXTS);
            timerDisplay.innerText = "00.0s";
            progressBar.style.width = "0%";

            timerInterval = setInterval(() => {
                const now = Date.now();
                const diff = (now - startTime) / 1000;
                timerDisplay.innerText = diff.toFixed(1) + "s";
            }, 100);

            progressInterval = setInterval(() => {
                // æ¨¡æ‹Ÿè¿›åº¦æ¡ï¼Œå‰æœŸå¿«åæœŸæ…¢
                if (progress < 60) progress += Math.random() * 2 + 1;
                else if (progress < 85) progress += Math.random() * 0.5;
                else if (progress < 95) progress += 0.1;
                
                if (progress > 98) progress = 98;
                progressBar.style.width = progress + "%";
            }, 200);
        }

        function stopLoadingAnimation(isSuccess) {
            clearInterval(timerInterval);
            clearInterval(progressInterval);
            if (isSuccess) document.getElementById('progressBar').style.width = "100%";
        }

        async function generateDailyImage() {
            const resultArea = document.getElementById('resultArea');
            const imageContainer = document.getElementById('imageContainer');
            const resultActions = document.getElementById('resultActions');
            const loadingState = document.getElementById('loadingState');

            // ç•Œé¢åˆ‡æ¢
            resultArea.classList.remove('hidden');
            loadingState.classList.remove('hidden');
            imageContainer.classList.add('hidden');
            resultActions.classList.add('hidden');

            const dateStr = getTodayDateString();
            document.getElementById('displayDate').innerText = dateStr;

            startLoadingAnimation();

            const url = `${BASE_URL}/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
            const payload = {
                contents: [{ parts: [{ text: getPrompt() }] }],
                generationConfig: {
                    responseModalities: ["IMAGE"],
                    imageConfig: { aspectRatio: "9:16", imageSize: "4K" }
                }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);

                const data = await response.json();

                if (data.candidates && data.candidates[0].content.parts[0].inlineData) {
                    stopLoadingAnimation(true);
                    const base64Data = data.candidates[0].content.parts[0].inlineData.data;
                    const mimeType = data.candidates[0].content.parts[0].inlineData.mimeType || 'image/png';
                    const imageUrl = `data:${mimeType};base64,${base64Data}`;

                    // å›¾ç‰‡åŠ è½½å®Œæˆåæ˜¾ç¤º
                    const imgElement = document.getElementById('generatedImage');
                    imgElement.onload = () => {
                        loadingState.classList.add('hidden');
                        imageContainer.classList.remove('hidden');
                        resultActions.classList.remove('hidden');
                    };
                    imgElement.src = imageUrl;
                    
                    const dlLink = document.getElementById('downloadLink');
                    dlLink.href = imageUrl;
                    dlLink.download = `ä»Šæ—¥ç¼˜åˆ†_${dateStr}_${Date.now()}.png`;
                } else {
                    throw new Error("ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•");
                }
            } catch (error) {
                console.error(error);
                stopLoadingAnimation(false);
                alert("è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•ã€‚");
                resetApp();
            }
        }

        function resetApp() {
            clearInterval(timerInterval);
            clearInterval(progressInterval);
            document.getElementById('resultArea').classList.add('hidden');
        }
    </script>
</body>
</html>